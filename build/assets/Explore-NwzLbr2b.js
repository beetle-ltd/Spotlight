import{r as n,d as q,j as e,C as M,e as J}from"./index-VIKamo1-.js";import{u as Q,t as Y,a as X,j as G,k as W,m as Z,E as ee,h as te,o as se,G as $,i as re}from"./index-C9XAXjcm.js";import"./button-ki5fLZzo.js";const oe=100,ne=g=>Q({queryKey:["recommendedProducts"],queryFn:async()=>{const u=JSON.parse(localStorage.getItem("storeData")||"{}"),h=Y(u);return(await X.post("/api/v1/stores/anonymous-recommendations",{data:h,page:1,perPage:oe})).data},retry:1,retryDelay:u=>Math.min(1e3*2**u,3e4),...g}),P={DOWN:40,UP:38,PAGE_DOWN:34,ESCAPE:27,PAGE_UP:33,ENTER:13};function ae({delay:g=500,source:u}){var A,K,R,_;const[h,b]=n.useState(null),o=n.useRef(null),a=n.useRef(null),[c,j]=n.useState({stores:[],keywords:[]}),[d,m]=n.useState(!1),[i,y]=n.useState(-1),[O,l]=n.useState(""),[p,f]=n.useState(""),[C,w]=n.useState(!1),[I,D]=n.useState(!1),[L,S]=n.useState([]),x=q();async function s(t){const r=`${W}/api/v1/stores/search-products-by-keyword?search=${t}&page=1&perPage=20`;w(!0);try{const E=await G.get(r);S(E.data.data),w(!1)}catch{D(!0),w(!1)}}function k(t){h&&clearTimeout(h),b(setTimeout(t,g))}function v(t,r){t>-1&&(console.log(t,r),r.startsWith("store")&&(f(c.stores[t].name),x(`/${c.stores[t].username}`)),r.startsWith("keyword")&&(f(c.keywords[t].name),s(c.keywords[t].name)))}async function B(t){if(t&&u){m(!0);const{stores:r,keywords:E}=await u(t);j({stores:r,keywords:E}),m(!1)}}function T(){k(()=>{j({stores:[],keywords:[]}),y(-1)})}function F(t){f(t),t.trim()?(m(!0),T(),k(()=>{B(t),m(!1)})):(T(),m(!1))}const N=((K=(A=o==null?void 0:o.current)==null?void 0:A.children[0])==null?void 0:K.clientHeight)+((_=(R=a.current)==null?void 0:R.children[0])==null?void 0:_.clientHeight);function H(){i>0&&y(i-1),o.current&&(o.current.scrollTop-=N,a.current&&(a.current.scrollTop-=N))}function z(){i<c.stores.length+c.keywords.length-1&&y(i+1),o.current&&(o.current.scrollTop=i*N,a.current&&(a.current.scrollTop=i*N))}function V(t){const r={[P.DOWN]:z,[P.UP]:H,[P.ENTER]:()=>{(c.keywords.length||c.stores.length)&&v(i,O),p.trim()&&s(p)},[P.ESCAPE]:T};r[t.keyCode]?r[t.keyCode]():y(-1)}return{bindOptionKey:{onClick:t=>{const r=Array.from(o==null?void 0:o.current.children);v(r.indexOf(t.target.closest("li")),t.target.id),l(t.target.id)}},bindOptionStore:{onClick:t=>{const r=Array.from(a==null?void 0:a.current.children);v(r.indexOf(t.target.closest("li")),t.target.id),l(t.target.id)}},bindInput:{value:p,onChange:t=>F(t.target.value),onKeyDown:V},bindOptionsKey:{ref:o},bindOptionsStores:{ref:a},isBusy:d,suggestions:c,setSuggestions:j,selectedIndex:i,textValue:p,isProductLoading:C,isProductError:I,productsByKeyword:L}}function U(g){return Z({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"11",cy:"11",r:"8"},child:[]},{tag:"path",attr:{d:"m21 21-4.3-4.3"},child:[]}]})(g)}function de(){var S;const g=localStorage.getItem("store_name")||"",{textValue:u,bindInput:h,bindOptionsKey:b,bindOptionsStores:o,bindOptionKey:a,bindOptionStore:c,isBusy:j,suggestions:d,setSuggestions:m,selectedIndex:i,isProductError:y,isProductLoading:O,productsByKeyword:l}=ae({delay:1e3,source:async x=>{try{const s=await G.get(`${W}/api/v1/stores/explore?name=${x}`),k=await s.data.data.keywords,v=await s.data.data.stores;return{keywords:k,stores:v}}catch{return[]}}}),p=n.useRef(null);n.useEffect(()=>{const x=s=>{p.current&&!p.current.contains(s.target)&&m({keywords:[],stores:[]})};return document.addEventListener("mousedown",x),()=>{document.removeEventListener("mousedown",x)}},[m]);const{data:f,isError:C,isLoading:w,error:I,refetch:D}=ne();if(C||y)return e.jsx(ee,{error:I,onRetry:D});if(w||O)return e.jsx(te,{delay:0,timeout:15e3});const L=(S=f==null?void 0:f.data)==null?void 0:S.data;return e.jsxs("div",{children:[e.jsx(M,{children:e.jsx("div",{className:"",children:e.jsx("div",{className:"block py-5",children:e.jsx(J,{url:`/${g}`})})})}),e.jsxs("div",{className:"flex flex-col items-center justify-center gap-y-20 py-10 min-h-[350px] bg-[url('/src/assets/explore-header.png')] bg-cover md:bg-center",children:[e.jsxs("h1",{className:"flex items-center text-center md:gap-x-2 text-2xl md:text-4xl font-semibold",children:["Find products and brands you love",e.jsx(se,{className:"hidden md:block"})]}),e.jsxs("div",{ref:p,className:"flex items-center relative border bg-white border-gray-300 p-3 sm:p-4 w-[90%] md:w-[50%] mx-auto rounded-full text-gray-500",children:[e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex items-center gap-x-2 w-full",children:[e.jsx(U,{size:20}),e.jsx("input",{placeholder:"Search",className:"flex-grow outline-none bg-transparent",...h})]}),u&&e.jsxs("div",{className:"shadow-lg w-full bg-white scroll-smooth absolute left-0 top-12 sm:top-14 z-20 max-h-[260px] overflow-x-hidden overflow-y-auto rounded-md",children:[j&&e.jsx("div",{className:"w-4 h-4 border-2 border-dashed rounded-full border-gray-500 animate-spin mx-auto my-5"}),d.keywords&&e.jsx("ul",{...b,id:"keywordsList",children:d.keywords.map((x,s)=>e.jsx("li",{className:"flex items-center h-[40px] p-2 hover:bg-gray-200 cursor-pointer py-2 "+(i===s&&"bg-gray-200"),id:`keywordListItem-${s}`,...a,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{children:e.jsx(U,{size:20})}),e.jsx("p",{className:"text-sm",children:d.keywords[s].name})]})},s))}),d.stores&&e.jsx("ul",{...o,id:"storesList",children:d.stores.map((x,s)=>e.jsx("li",{className:"flex items-center h-[40px] p-2 hover:bg-gray-200 cursor-pointer py-2 "+(i===s&&"bg-gray-200"),id:`storeListItem-${s}`,...c,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{children:e.jsx("img",{src:d.stores[s].logo,alt:d.stores[s].name,className:"w-6 h-6 rounded-full"})}),e.jsx("p",{className:"text-sm",children:d.stores[s].name})]})},s))})]})]}),e.jsx("p",{children:e.jsxs("kbd",{className:"pointer-events-none inline-flex h-5 select-none items-center gap-1 rounded bg-none px-1.5 font-mono text-[10px] font-medium text-muted-foreground opacity-100",children:[e.jsx("span",{className:"text-xs",children:"âŒ˜"}),"K"]})})]})]}),e.jsx("div",{className:"w-full min-h-[700px]  mx-auto pb-10 ",children:e.jsx("div",{className:"mx-auto w-full md:w-[90%]",children:l&&l.data&&(l==null?void 0:l.data.length)>0?e.jsx($,{products:l==null?void 0:l.data}):e.jsx($,{products:L})})}),e.jsx(re,{})]})}export{de as default};
